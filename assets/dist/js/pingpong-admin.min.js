var PingPong_Admin_MatchCPTs;!function(e){"use strict";var a={},s={};"undefined"!=typeof PingPong_Admin&&(a=PingPong_Admin,s="undefined"!=typeof PingPong_Admin.l10n?PingPong_Admin.l10n:{});var t=PingPong_Admin_MatchCPTs={$scores_modal:null,$games_input:null,scores:{players:{},teams:{},matches:[]},init:function(){t.get_elements(),t.setup_handlers(),t.initialize_match_type(),a.scores&&(t.scores=a.scores)},get_elements:function(){t.$scores_modal=e("#pingpong-scores-modal"),t.$games_input=e('select[name="_rbm_games"]'),t.$game_type_input=e('input[name="_rbm_type"]')},setup_handlers:function(){e(document).on("click",'#match-type .rbm-field-radio input[type="radio"]',t.match_type_select),e(document).on("click","[data-scores-close]",t.scores_modal_close),e(document).on("click","[data-scores-open]",t.scores_modal_add_scores),e(document).on("click","[data-scores-submit]",t.scores_modal_submit),e(document).on("change",'.pingpong-scores-table input[type="number"]',t.scores_update),e(document).on("click","body.post-type-match.pingpong-matches-complete .wp-list-table a.row-title,body.post-type-match.pingpong-matches-complete .wp-list-table .row-actions .edit a",t.scores_modal_preview)},initialize_match_type:function(){e('#match-type .rbm-field-radio input[type="radio"]:checked').click()},match_type_select:function(){var a=e(this).val(),s=e("#match-settings-"+a),t=e('[id^="match-settings-"]:not(#match-settings-'+a+")");s.length&&(s.show(),t.hide())},scores_modal_add_scores:function(){var a,s,o,n,r,l,i,d=t.$games_input.val(),p=t.$game_type_input.filter(":checked").val(),_=t.$scores_modal.find(".pingpong-scores-table"),m=(_.find("thead tr"),_.find("tbody"),0);switch(e("body").addClass("pingpong-modal-open"),m=parseInt(d),t.scores_modal_open(),p){case"singles":var c=[];if(a=e('select[name="_rbm_singles_players[]"]'),o=a.val()){for(i=0;i<o.length;i++)c.push({name:a.find('option[value="'+o[i]+'"]').html().trim(),id:o[i]});l=t.scores_modal_get_table_data("singles",c)}t.scores_modal_populate_table(m,l.rows,l.footer);break;case"doubles":var u=[];if(s=e('select[name="_rbm_doubles_teams[]"]'),n=s.val())for(i=0;i<n.length;i++)u.push({name:s.find('option[value="'+n[i]+'"]').html().trim(),id:n[i]});t.scores_modal_get_table_data("doubles",!1,u),t.scores_modal_populate_table(m,l.rows);break;case"team":if(s=e('select[name="_rbm_teams[]"]'),n=s.val()){for(t.$scores_modal.find(".pingpong-scores-container").addClass("loading"),r={},i=0;i<n.length;i++)r[n[i]]=s.find('option[value="'+n[i]+'"]').html().trim();e.post(ajaxurl,{action:"pingpong_get_team_players",team_IDs:n},function(e){var a=e.data;t.$scores_modal.find(".pingpong-scores-container").removeClass("loading"),"undefined"!=typeof e.success&&e.success&&(l=t.scores_modal_get_table_data("team",!1,a),t.scores_modal_populate_table(m,l.rows,l.footer))})}}},scores_modal_preview:function(a){var s=e(this).closest("tr").attr("id").match(/post-(\d+)/)[1];a.preventDefault(),e.post(ajaxurl,{action:"pingpong_get_match_scores",match_id:s},function(e){var a;if("undefined"!=typeof e.success&&e.success){switch(e.data.type){case"singles":a=t.scores_modal_get_table_data("singles",e.data.scores.players);break;case"doubles":break;case"team":a=t.scores_modal_get_table_data("team",!1,e.data.scores.teams)}t.scores_modal_populate_table(e.data.scores.matches[0].length,a.rows,a.footer),t.scores_modal_populate_scores(e.data.scores.matches),t.$scores_modal.find('input[type="number"]').prop("disabled",!0),t.scores_modal_open()}})},scores_modal_open:function(){t.$scores_modal.show()},scores_modal_get_table_data:function(e,a,s){var t,o=[],n=[];switch(e){case"singles":for(t=0;t<a.length;t++)o.push({label:a[t].name,player_id:a[t].id}),n.push({label:a[t].name,player_id:a[t].id});break;case"doubles":for(t=0;t<s.length;t++)o.push({label:s[t].name,team_id:s[t].id});break;case"team":o.push({label:"<strong>"+s[0].name+":</strong> "+s[0].players[0].name,team_id:s[0].id,player_id:s[0].players[0].id}),o.push({label:"<strong>"+s[1].name+":</strong> "+s[1].players[0].name,team_id:s[1].id,player_id:s[1].players[0].id}),o.push({label:"<strong>"+s[0].name+":</strong> "+s[0].players[1].name,team_id:s[0].id,player_id:s[0].players[1].id}),o.push({label:"<strong>"+s[1].name+":</strong> "+s[1].players[1].name,team_id:s[1].id,player_id:s[1].players[1].id}),o.push({label:"<strong>"+s[0].name+":</strong> "+s[0].players[0].name,team_id:s[0].id,player_id:s[0].players[0].id}),o.push({label:"<strong>"+s[1].name+":</strong> "+s[1].players[1].name,team_id:s[1].id,player_id:s[1].players[1].id}),o.push({label:"<strong>"+s[0].name+":</strong> "+s[0].players[1].name,team_id:s[0].id,player_id:s[0].players[1].id}),o.push({label:"<strong>"+s[1].name+":</strong> "+s[1].players[0].name,team_id:s[1].id,player_id:s[1].players[0].id}),n.push({label:s[0].name,team_id:s[0].id}),n.push({label:s[1].name,team_id:s[1].id}),n.push({label:s[0].players[0].name,player_id:s[0].players[0].id}),n.push({label:s[0].players[1].name,player_id:s[0].players[1].id}),n.push({label:s[1].players[0].name,player_id:s[1].players[0].id}),n.push({label:s[1].players[1].name,player_id:s[1].players[1].id})}return{rows:o,footer:n}},scores_modal_populate_table:function(o,n,r){var l,i,d,p,_,m,c,u=t.$scores_modal.find(".pingpong-scores-table"),y=u.find("tbody"),g=u.find("tfoot");for(u.find("thead").append("<tr />"),l=u.find("thead tr"),l.append("<th />"),m=0;m<o;m++)l.append(e("<th>"+s.game+" "+(m+1)+"</th>"));for(_=0;_<n.length;_++){for(d="undefined"!=typeof n[_].player_id?n[_].player_id:"",p="undefined"!=typeof n[_].team_id?n[_].team_id:"",i='<tr data-player-id="'+d+'" data-team-id="'+p+'"><td>'+n[_].label+"</td>",m=0;m<o;m++)i+='<td><input type="number" value="0" /></td>';i+="</tr>",y.append(e(i))}if(r)for(g.append(e('<tr class="pingpong-tfoot-title"><td colspan="'+(o+1)+'">'+s.totals+":</td></tr>")),c=0;c<r.length;c++)d="undefined"!=typeof r[c].player_id?r[c].player_id:"",p="undefined"!=typeof r[c].team_id?r[c].team_id:"",g.append(e("<tr><td>"+r[c].label+'</td><td data-player-id="'+d+'" data-team-id="'+p+'">0</td><td colspan="'+(o-1)+'"></td></tr>'));a.scores&&t.scores_modal_populate_scores(a.scores.matches)},scores_modal_populate_scores:function(a){return a.length!==t.$scores_modal.find("tbody tr").length/2?void t.scores_modal_error(s.cant_load_scores):(t.$scores_modal.find('tbody td:not(:first-of-type) input[type="number"]').each(function(){var s=e(this).closest("tr"),t=Math.floor(s.index()/2),o=e(this).closest("td").index()-1,n=s.index()%2===1?1:0;e(this).val(a[t][o][n])}),void t.scores_update())},scores_modal_error:function(e){t.$scores_modal.find(".pingpong-scores-error").slideDown().find("p").html(e)},scores_modal_close:function(){e("body").removeClass("pingpong-modal-open"),t.$scores_modal.find(".pingpong-scores-error").hide(),t.$scores_modal.find("thead, tbody, tfoot").html(""),t.$scores_modal.hide()},scores_update:function(){var a,s,o=t.$scores_modal.find("tbody tr").length/2,n=t.$scores_modal.find("thead th").length-1,r={},l={},i={win:null,scores:[],player_1:{id:0,team_id:0,games:0,$row:null},player_2:{id:0,team_id:0,games:0,$row:null}},d={player_1:{score:0,$input:null},player_2:{score:0,$input:null}},p=[];for(a=0;a<o;a++){for(i.player_1.$row=t.$scores_modal.find("tbody tr:eq("+2*a+")"),i.player_2.$row=t.$scores_modal.find("tbody tr:eq("+(2*a+1)+")"),i.player_1.id=i.player_1.$row.attr("data-player-id"),i.player_2.id=i.player_2.$row.attr("data-player-id"),i.player_1.team_id=i.player_1.$row.attr("data-team-id"),i.player_2.team_id=i.player_2.$row.attr("data-team-id"),"undefined"==typeof r[i.player_1.id]&&(r.length++,r[i.player_1.id]={games:0,points:0}),"undefined"==typeof r[i.player_2.id]&&(r.length++,r[i.player_2.id]={games:0,points:0}),"undefined"==typeof l[i.player_1.team_id]&&(l.length++,l[i.player_1.team_id]=0),"undefined"==typeof l[i.player_2.team_id]&&(l.length++,l[i.player_2.team_id]=0),i.player_1.games=0,i.player_2.games=0,i.win=null,i.scores=[],s=0;s<n;s++)d.player_1.$input=i.player_1.$row.find("td:eq("+(s+1)+') input[type="number"]'),d.player_2.$input=i.player_2.$row.find("td:eq("+(s+1)+') input[type="number"]'),i.player_1.games>=Math.floor(n/2)+1?(i.win=1,d.player_1.$input.prop("disabled",!0),d.player_2.$input.prop("disabled",!0)):i.player_2.games>=Math.floor(n/2)+1?(i.win=2,d.player_1.$input.prop("disabled",!0),d.player_2.$input.prop("disabled",!0)):(d.player_1.$input.prop("disabled",!1),d.player_2.$input.prop("disabled",!1)),d.player_1.score=parseInt(d.player_1.$input.val()),d.player_2.score=parseInt(d.player_2.$input.val()),d.player_1.score>=11&&d.player_1.score-d.player_2.score>=2?i.player_1.games++:d.player_2.score>=11&&d.player_2.score-d.player_1.score>=2&&i.player_2.games++,i.scores.push([{id:i.player_1.id,score:d.player_1.score},{id:i.player_2.id,score:d.player_2.score}]);r[i.player_1.id].games=r[i.player_1.id].games+i.player_1.games,r[i.player_2.id].games=r[i.player_2.id].games+i.player_2.games,i.win&&(l[i["player_"+i.win].team_id]=l[i["player_"+i.win].team_id]+1),p.push(i.scores)}t.scores.players=r,t.scores.teams=l,t.scores.matches=p,console.log(t.scores),e.each(r,function(e,a){return"length"==e||!e||void t.$scores_modal.find('tfoot [data-player-id="'+e+'"]').html(a.games)}),e.each(l,function(e,a){return"length"==e||!e||void t.$scores_modal.find('tfoot [data-team-id="'+e+'"]').html(a)})},scores_modal_submit:function(){confirm(s.confirm_submit_match)&&e.post(ajaxurl,{action:"pingpong_submit_scores",match_ID:a.match_ID,scores:t.scores},function(e){if("undefined"==typeof e.success||!e.success)return void alert(s.could_not_save_match)})}};e(t.init)}(jQuery);var PingPong_Admin_MatchCPTs;!function(e){"use strict";var a={},s={};"undefined"!=typeof PingPong_Admin&&(a=PingPong_Admin,s="undefined"!=typeof PingPong_Admin.l10n?PingPong_Admin.l10n:{});var t=PingPong_Admin_MatchCPTs={$games:null,init:function(){t.get_elements(),t.setup_handlers()},get_elements:function(){t.$games=e("#pingpong-won-games")},setup_handlers:function(){e(document).on("click","[data-expand-games]",t.toggle_games)},toggle_games:function(a){var o=t.$games.is(":visible");a.preventDefault(),o?(e(this).html(s.view_matches),t.hide_games()):(e(this).html(s.hide_matches),t.expand_games())},expand_games:function(e){t.$games.show()},hide_games:function(e){t.$games.hide()}};e(t.init)}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBpbmdwb25nLWFkbWluLm1pbi5qcyJdLCJuYW1lcyI6WyJQaW5nUG9uZ19BZG1pbl9NYXRjaENQVHMiLCIkIiwiZGF0YSIsImwxMG4iLCJQaW5nUG9uZ19BZG1pbiIsImFwaSIsIiRzY29yZXNfbW9kYWwiLCIkZ2FtZXNfaW5wdXQiLCJzY29yZXMiLCJwbGF5ZXJzIiwidGVhbXMiLCJtYXRjaGVzIiwiaW5pdCIsImdldF9lbGVtZW50cyIsInNldHVwX2hhbmRsZXJzIiwiaW5pdGlhbGl6ZV9tYXRjaF90eXBlIiwiJGdhbWVfdHlwZV9pbnB1dCIsImRvY3VtZW50Iiwib24iLCJtYXRjaF90eXBlX3NlbGVjdCIsInNjb3Jlc19tb2RhbF9jbG9zZSIsInNjb3Jlc19tb2RhbF9hZGRfc2NvcmVzIiwic2NvcmVzX21vZGFsX3N1Ym1pdCIsInNjb3Jlc191cGRhdGUiLCJzY29yZXNfbW9kYWxfcHJldmlldyIsImNsaWNrIiwidHlwZSIsInRoaXMiLCJ2YWwiLCIkbWJfYWN0aXZlIiwiJG1iX2luYWN0aXZlIiwibGVuZ3RoIiwic2hvdyIsImhpZGUiLCIkcGxheWVyc19zZWxlY3QiLCIkdGVhbXNfc2VsZWN0IiwicGxheWVyX0lEcyIsInRlYW1fSURzIiwidGVhbV9uYW1lcyIsInRhYmxlX2RhdGEiLCJpIiwiZ2FtZXMiLCJnYW1lX3R5cGUiLCJmaWx0ZXIiLCIkdGFibGUiLCJmaW5kIiwiY29sdW1ucyIsImFkZENsYXNzIiwicGFyc2VJbnQiLCJzY29yZXNfbW9kYWxfb3BlbiIsInB1c2giLCJuYW1lIiwiaHRtbCIsInRyaW0iLCJpZCIsInNjb3Jlc19tb2RhbF9nZXRfdGFibGVfZGF0YSIsInNjb3Jlc19tb2RhbF9wb3B1bGF0ZV90YWJsZSIsInJvd3MiLCJmb290ZXIiLCJwb3N0IiwiYWpheHVybCIsImFjdGlvbiIsInJlc3BvbnNlIiwicmVtb3ZlQ2xhc3MiLCJzdWNjZXNzIiwiZSIsIm1hdGNoX2lkIiwiY2xvc2VzdCIsImF0dHIiLCJtYXRjaCIsInByZXZlbnREZWZhdWx0Iiwic2NvcmVzX21vZGFsX3BvcHVsYXRlX3Njb3JlcyIsInByb3AiLCJsYWJlbCIsInBsYXllcl9pZCIsInRlYW1faWQiLCIkdGhlYWRfcm93Iiwicm93Iiwicm93X2kiLCJjb2x1bW5faSIsImZvb3RfaSIsIiR0Ym9keSIsIiR0Zm9vdCIsImFwcGVuZCIsInNjb3Jlc19tb2RhbF9lcnJvciIsImVhY2giLCIkcm93IiwiTWF0aCIsImZsb29yIiwiaW5kZXgiLCJnYW1lIiwicGxheWVyX2luZGV4IiwibWVzc2FnZSIsInNsaWRlRG93biIsIm1hdGNoX2kiLCJnYW1lX2kiLCJ0b3RhbF9tYXRjaGVzIiwidG90YWxfZ2FtZXMiLCJ3aW4iLCJwbGF5ZXJfMSIsInBsYXllcl8yIiwic2NvcmUiLCIkaW5wdXQiLCJwb2ludHMiLCJjb25zb2xlIiwibG9nIiwicGxheWVyX0lEIiwicGxheWVyIiwidGVhbV9JRCIsInRlYW1fc2NvcmUiLCJjb25maXJtIiwibWF0Y2hfSUQiLCJhbGVydCIsImpRdWVyeSIsIiRnYW1lcyIsInRvZ2dsZV9nYW1lcyIsImlzIiwiaGlkZV9nYW1lcyIsImV4cGFuZF9nYW1lcyJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsMkJBQ0osU0FBV0MsR0FDUCxZQUVBLElBQUlDLE1BQVdDLElBRWMsb0JBQWxCQyxrQkFFUEYsRUFBT0UsZUFDUEQsRUFBcUMsbUJBQXZCQyxnQkFBZUQsS0FBc0JDLGVBQWVELFFBR3RFLElBQUlFLEdBQU1MLDBCQU9OTSxjQUFlLEtBT2ZDLGFBQWMsS0FPZEMsUUFDSUMsV0FDQUMsU0FDQUMsWUFRSkMsS0FBTSxXQUVGUCxFQUFJUSxlQUNKUixFQUFJUyxpQkFDSlQsRUFBSVUsd0JBRUFiLEVBQUtNLFNBRUxILEVBQUlHLE9BQVNOLEVBQUtNLFNBUzFCSyxhQUFjLFdBRVZSLEVBQUlDLGNBQWdCTCxFQUFFLDBCQUN0QkksRUFBSUUsYUFBZU4sRUFBRSw2QkFDckJJLEVBQUlXLGlCQUFtQmYsRUFBRSw0QkFRN0JhLGVBQWdCLFdBRVpiLEVBQUVn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QkMsa0JBRVBGLEVBQU9FLGVBQ1BELEVBQXFDLG1CQUF2QkMsZ0JBQWVELEtBQXNCQyxlQUFlRCxRQUd0RSxJQUFJRSxHQUFNTCwwQkFPTmtILE9BQVEsS0FPUnRHLEtBQU0sV0FFRlAsRUFBSVEsZUFDSlIsRUFBSVMsa0JBUVJELGFBQWMsV0FFVlIsRUFBSTZHLE9BQVNqSCxFQUFFLHdCQVFuQmEsZUFBZ0IsV0FFWmIsRUFBRWdCLFVBQVVDLEdBQUcsUUFBUyxzQkFBdUJiLEVBQUk4RyxlQVV2REEsYUFBYyxTQUFVbEQsR0FFcEIsR0FBSWhDLEdBQU81QixFQUFJNkcsT0FBT0UsR0FBRyxXQUV6Qm5ELEdBQUVLLGlCQUVFckMsR0FFQWhDLEVBQUUwQixNQUFNeUIsS0FBS2pELEVBQW1CLGNBQ2hDRSxFQUFJZ0gsZUFJSnBILEVBQUUwQixNQUFNeUIsS0FBS2pELEVBQW1CLGNBQ2hDRSxFQUFJaUgsaUJBU1pBLGFBQWMsU0FBVXJELEdBRXBCNUQsRUFBSTZHLE9BQU9sRixRQVNmcUYsV0FBWSxTQUFVcEQsR0FFbEI1RCxFQUFJNkcsT0FBT2pGLFFBSW5CaEMsR0FBRUksRUFBSU8sT0FDUHFHIiwiZmlsZSI6InBpbmdwb25nLWFkbWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBQaW5nUG9uZ19BZG1pbl9NYXRjaENQVHNcbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkYXRhID0ge30sIGwxMG4gPSB7fTtcblxuICAgIGlmICh0eXBlb2YgUGluZ1BvbmdfQWRtaW4gIT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgICAgICBkYXRhID0gUGluZ1BvbmdfQWRtaW47XG4gICAgICAgIGwxMG4gPSB0eXBlb2YgUGluZ1BvbmdfQWRtaW4ubDEwbiAhPSAndW5kZWZpbmVkJyA/IFBpbmdQb25nX0FkbWluLmwxMG4gOiB7fTtcbiAgICB9XG5cbiAgICB2YXIgYXBpID0gUGluZ1BvbmdfQWRtaW5fTWF0Y2hDUFRzID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IGZvciB0aGUgc2NvcmVzIG1vZGFsLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgICRzY29yZXNfbW9kYWw6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIGpRdWVyeSBvYmplY3QgZm9yIHRoZSBnYW1lcyBpbnB1dC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICAkZ2FtZXNfaW5wdXQ6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNjb3JlcyB0byBiZSBzdWJtaXR0ZWQgZm9yIHNhdmluZy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBzY29yZXM6IHtcbiAgICAgICAgICAgIHBsYXllcnM6IHt9LFxuICAgICAgICAgICAgdGVhbXM6IHt9LFxuICAgICAgICAgICAgbWF0Y2hlczogW10sXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemVzIHRoaXMgb2JqZWN0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIGluaXQ6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgYXBpLmdldF9lbGVtZW50cygpO1xuICAgICAgICAgICAgYXBpLnNldHVwX2hhbmRsZXJzKCk7XG4gICAgICAgICAgICBhcGkuaW5pdGlhbGl6ZV9tYXRjaF90eXBlKCk7XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnNjb3Jlcykge1xuXG4gICAgICAgICAgICAgICAgYXBpLnNjb3JlcyA9IGRhdGEuc2NvcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHZXRzIGFsbCBqUXVlcnkgZWxlbWVudHMgbmVlZGVkLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIGdldF9lbGVtZW50czogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBhcGkuJHNjb3Jlc19tb2RhbCA9ICQoJyNwaW5ncG9uZy1zY29yZXMtbW9kYWwnKTtcbiAgICAgICAgICAgIGFwaS4kZ2FtZXNfaW5wdXQgPSAkKCdzZWxlY3RbbmFtZT1cIl9yYm1fZ2FtZXNcIl0nKTtcbiAgICAgICAgICAgIGFwaS4kZ2FtZV90eXBlX2lucHV0ID0gJCgnaW5wdXRbbmFtZT1cIl9yYm1fdHlwZVwiXScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTZXRzIHVwIGhhbmRsZXJzIG9uIGV2ZW50cy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBzZXR1cF9oYW5kbGVyczogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAkKGRvY3VtZW50KS5vbignY2xpY2snLCAnI21hdGNoLXR5cGUgLnJibS1maWVsZC1yYWRpbyBpbnB1dFt0eXBlPVwicmFkaW9cIl0nLCBhcGkubWF0Y2hfdHlwZV9zZWxlY3QpO1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXNjb3Jlcy1jbG9zZV0nLCBhcGkuc2NvcmVzX21vZGFsX2Nsb3NlKTtcbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICdbZGF0YS1zY29yZXMtb3Blbl0nLCBhcGkuc2NvcmVzX21vZGFsX2FkZF9zY29yZXMpO1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLXNjb3Jlcy1zdWJtaXRdJywgYXBpLnNjb3Jlc19tb2RhbF9zdWJtaXQpO1xuICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcucGluZ3Bvbmctc2NvcmVzLXRhYmxlIGlucHV0W3R5cGU9XCJudW1iZXJcIl0nLCBhcGkuc2NvcmVzX3VwZGF0ZSk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsXG4gICAgICAgICAgICAgICAgJ2JvZHkucG9zdC10eXBlLW1hdGNoLnBpbmdwb25nLW1hdGNoZXMtY29tcGxldGUgLndwLWxpc3QtdGFibGUgYS5yb3ctdGl0bGUsJyArXG4gICAgICAgICAgICAgICAgJ2JvZHkucG9zdC10eXBlLW1hdGNoLnBpbmdwb25nLW1hdGNoZXMtY29tcGxldGUgLndwLWxpc3QtdGFibGUgLnJvdy1hY3Rpb25zIC5lZGl0IGEnLFxuICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfcHJldmlldyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemVzIHRoZSBhY3RpdmUgbWF0Y2ggdHlwZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBpbml0aWFsaXplX21hdGNoX3R5cGU6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgJCgnI21hdGNoLXR5cGUgLnJibS1maWVsZC1yYWRpbyBpbnB1dFt0eXBlPVwicmFkaW9cIl06Y2hlY2tlZCcpLmNsaWNrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gc2VsZWN0aW5nIGEgbWF0Y2ggdHlwZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBtYXRjaF90eXBlX3NlbGVjdDogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgdHlwZSA9ICQodGhpcykudmFsKCksXG4gICAgICAgICAgICAgICAgJG1iX2FjdGl2ZSA9ICQoJyNtYXRjaC1zZXR0aW5ncy0nICsgdHlwZSksXG4gICAgICAgICAgICAgICAgJG1iX2luYWN0aXZlID0gJCgnW2lkXj1cIm1hdGNoLXNldHRpbmdzLVwiXTpub3QoI21hdGNoLXNldHRpbmdzLScgKyB0eXBlICsgJyknKTtcblxuICAgICAgICAgICAgaWYgKCEkbWJfYWN0aXZlLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkbWJfYWN0aXZlLnNob3coKTtcbiAgICAgICAgICAgICRtYl9pbmFjdGl2ZS5oaWRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIE9wZW5zIHRoZSBzY29yZXMgbW9kYWwuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgc2NvcmVzX21vZGFsX2FkZF9zY29yZXM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGdhbWVzID0gYXBpLiRnYW1lc19pbnB1dC52YWwoKSxcbiAgICAgICAgICAgICAgICBnYW1lX3R5cGUgPSBhcGkuJGdhbWVfdHlwZV9pbnB1dC5maWx0ZXIoJzpjaGVja2VkJykudmFsKCksXG4gICAgICAgICAgICAgICAgJHRhYmxlID0gYXBpLiRzY29yZXNfbW9kYWwuZmluZCgnLnBpbmdwb25nLXNjb3Jlcy10YWJsZScpLFxuICAgICAgICAgICAgICAgICR0aGVhZF9yb3cgPSAkdGFibGUuZmluZCgndGhlYWQgdHInKSxcbiAgICAgICAgICAgICAgICAkdGJvZHkgPSAkdGFibGUuZmluZCgndGJvZHknKSxcbiAgICAgICAgICAgICAgICAkdGJvZHlfcm93cyxcbiAgICAgICAgICAgICAgICAkcGxheWVyc19zZWxlY3QsXG4gICAgICAgICAgICAgICAgJHRlYW1zX3NlbGVjdCxcbiAgICAgICAgICAgICAgICBwbGF5ZXJfSURzLCB0ZWFtX0lEcywgdGVhbV9uYW1lcyxcbiAgICAgICAgICAgICAgICB0YWJsZV9kYXRhLFxuICAgICAgICAgICAgICAgIGNvbHVtbnMgPSAwLCByb3dzID0gW10sIGZvb3RlciA9IFtdLCBpO1xuXG4gICAgICAgICAgICAkKCdib2R5JykuYWRkQ2xhc3MoJ3Bpbmdwb25nLW1vZGFsLW9wZW4nKTtcblxuICAgICAgICAgICAgY29sdW1ucyA9IHBhcnNlSW50KGdhbWVzKTtcblxuICAgICAgICAgICAgYXBpLnNjb3Jlc19tb2RhbF9vcGVuKCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSByb3dzXG4gICAgICAgICAgICBzd2l0Y2ggKGdhbWVfdHlwZSkge1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnc2luZ2xlcyc6XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBsYXllcnMgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICAkcGxheWVyc19zZWxlY3QgPSAkKCdzZWxlY3RbbmFtZT1cIl9yYm1fc2luZ2xlc19wbGF5ZXJzW11cIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyX0lEcyA9ICRwbGF5ZXJzX3NlbGVjdC52YWwoKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxheWVyX0lEcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVycy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJHBsYXllcnNfc2VsZWN0LmZpbmQoJ29wdGlvblt2YWx1ZT1cIicgKyBwbGF5ZXJfSURzW2ldICsgJ1wiXScpLmh0bWwoKS50cmltKCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBwbGF5ZXJfSURzW2ldXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2RhdGEgPSBhcGkuc2NvcmVzX21vZGFsX2dldF90YWJsZV9kYXRhKCdzaW5nbGVzJywgcGxheWVycylcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfcG9wdWxhdGVfdGFibGUoY29sdW1ucywgdGFibGVfZGF0YS5yb3dzLCB0YWJsZV9kYXRhLmZvb3Rlcik7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICdkb3VibGVzJzpcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdGVhbXMgPSBbXTtcblxuICAgICAgICAgICAgICAgICAgICAkdGVhbXNfc2VsZWN0ID0gJCgnc2VsZWN0W25hbWU9XCJfcmJtX2RvdWJsZXNfdGVhbXNbXVwiXScpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0ZWFtX0lEcyA9ICR0ZWFtc19zZWxlY3QudmFsKCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRlYW1fSURzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZWFtcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJHRlYW1zX3NlbGVjdC5maW5kKCdvcHRpb25bdmFsdWU9XCInICsgdGVhbV9JRHNbaV0gKyAnXCJdJykuaHRtbCgpLnRyaW0oKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IHRlYW1fSURzW2ldXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhcGkuc2NvcmVzX21vZGFsX2dldF90YWJsZV9kYXRhKCdkb3VibGVzJywgZmFsc2UsIHRlYW1zKTtcblxuICAgICAgICAgICAgICAgICAgICBhcGkuc2NvcmVzX21vZGFsX3BvcHVsYXRlX3RhYmxlKGNvbHVtbnMsIHRhYmxlX2RhdGEucm93cyk7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICd0ZWFtJzpcblxuICAgICAgICAgICAgICAgICAgICAkdGVhbXNfc2VsZWN0ID0gJCgnc2VsZWN0W25hbWU9XCJfcmJtX3RlYW1zW11cIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGVhbV9JRHMgPSAkdGVhbXNfc2VsZWN0LnZhbCgpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJy5waW5ncG9uZy1zY29yZXMtY29udGFpbmVyJykuYWRkQ2xhc3MoJ2xvYWRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9uYW1lcyA9IHt9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGVhbV9JRHMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1fbmFtZXNbdGVhbV9JRHNbaV1dID0gJHRlYW1zX3NlbGVjdC5maW5kKCdvcHRpb25bdmFsdWU9XCInICsgdGVhbV9JRHNbaV0gKyAnXCJdJykuaHRtbCgpLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgJC5wb3N0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFqYXh1cmwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdwaW5ncG9uZ19nZXRfdGVhbV9wbGF5ZXJzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9JRHM6IHRlYW1fSURzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVhbXMgPSByZXNwb25zZS5kYXRhO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJy5waW5ncG9uZy1zY29yZXMtY29udGFpbmVyJykucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlLnN1Y2Nlc3MgPT0gJ3VuZGVmaW5lZCcgfHwgIXJlc3BvbnNlLnN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVfZGF0YSA9IGFwaS5zY29yZXNfbW9kYWxfZ2V0X3RhYmxlX2RhdGEoJ3RlYW0nLCBmYWxzZSwgdGVhbXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfcG9wdWxhdGVfdGFibGUoY29sdW1ucywgdGFibGVfZGF0YS5yb3dzLCB0YWJsZV9kYXRhLmZvb3Rlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFByZXZpZXcgc2NvcmVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIHNjb3Jlc19tb2RhbF9wcmV2aWV3OiBmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICB2YXIgbWF0Y2hfaWQgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignaWQnKS5tYXRjaCgvcG9zdC0oXFxkKykvKVsxXTtcblxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgICAgICAkLnBvc3QoXG4gICAgICAgICAgICAgICAgYWpheHVybCxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ3Bpbmdwb25nX2dldF9tYXRjaF9zY29yZXMnLFxuICAgICAgICAgICAgICAgICAgICBtYXRjaF9pZDogbWF0Y2hfaWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZV9kYXRhO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2Uuc3VjY2VzcyA9PSAndW5kZWZpbmVkJyB8fCAhcmVzcG9uc2Uuc3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlc3BvbnNlLmRhdGEudHlwZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdzaW5nbGVzJzpcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlX2RhdGEgPSBhcGkuc2NvcmVzX21vZGFsX2dldF90YWJsZV9kYXRhKCdzaW5nbGVzJywgcmVzcG9uc2UuZGF0YS5zY29yZXMucGxheWVycyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnZG91Ymxlcyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ3RlYW0nOlxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVfZGF0YSA9IGFwaS5zY29yZXNfbW9kYWxfZ2V0X3RhYmxlX2RhdGEoJ3RlYW0nLCBmYWxzZSwgcmVzcG9uc2UuZGF0YS5zY29yZXMudGVhbXMpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBhcGkuc2NvcmVzX21vZGFsX3BvcHVsYXRlX3RhYmxlKFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZGF0YS5zY29yZXMubWF0Y2hlc1swXS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9kYXRhLnJvd3MsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZV9kYXRhLmZvb3RlclxuICAgICAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfcG9wdWxhdGVfc2NvcmVzKHJlc3BvbnNlLmRhdGEuc2NvcmVzLm1hdGNoZXMpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIERpc2FibGUgYmVjYXVzZSBpdCdzIG9ubHkgYSBwcmV2aWV3XG4gICAgICAgICAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJ2lucHV0W3R5cGU9XCJudW1iZXJcIl0nKS5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuXG4gICAgICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfb3BlbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogT3BlbnMgdGhlIHNjb3JlcyBtb2RhbC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBzY29yZXNfbW9kYWxfb3BlbjogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBhcGkuJHNjb3Jlc19tb2RhbC5zaG93KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEdldHMgdGFibGUgZGF0YSBmb3IgdXNlIGluIHBvcHVsYXRpbmcgaXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gdHlwZVxuICAgICAgICAgKiBAcGFyYW0gcGxheWVyc1xuICAgICAgICAgKiBAcGFyYW0gdGVhbXNcbiAgICAgICAgICovXG4gICAgICAgIHNjb3Jlc19tb2RhbF9nZXRfdGFibGVfZGF0YTogZnVuY3Rpb24gKHR5cGUsIHBsYXllcnMsIHRlYW1zKSB7XG5cbiAgICAgICAgICAgIHZhciByb3dzID0gW10sIGZvb3RlciA9IFtdLCBpO1xuXG4gICAgICAgICAgICBzd2l0Y2ggKHR5cGUpIHtcblxuICAgICAgICAgICAgICAgIGNhc2UgJ3NpbmdsZXMnOlxuXG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBwbGF5ZXJzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHBsYXllcnNbaV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfaWQ6IHBsYXllcnNbaV1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBmb290ZXIucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHBsYXllcnNbaV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfaWQ6IHBsYXllcnNbaV1bJ2lkJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgY2FzZSAnZG91Ymxlcyc6XG5cbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHRlYW1zLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zW2ldWyduYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogdGVhbXNbaV1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICBjYXNlICd0ZWFtJzpcblxuICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICc8c3Ryb25nPicgKyB0ZWFtc1swXVsnbmFtZSddICsgJzo8L3N0cm9uZz4gJyArIHRlYW1zWzBdWydwbGF5ZXJzJ11bMF1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1faWQ6IHRlYW1zWzBdWydpZCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2lkOiB0ZWFtc1swXVsncGxheWVycyddWzBdWydpZCddXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJzxzdHJvbmc+JyArIHRlYW1zWzFdWyduYW1lJ10gKyAnOjwvc3Ryb25nPiAnICsgdGVhbXNbMV1bJ3BsYXllcnMnXVswXVsnbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogdGVhbXNbMV1bJ2lkJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfaWQ6IHRlYW1zWzFdWydwbGF5ZXJzJ11bMF1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnPHN0cm9uZz4nICsgdGVhbXNbMF1bJ25hbWUnXSArICc6PC9zdHJvbmc+ICcgKyB0ZWFtc1swXVsncGxheWVycyddWzFdWyduYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtX2lkOiB0ZWFtc1swXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMF1bJ3BsYXllcnMnXVsxXVsnaWQnXVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICc8c3Ryb25nPicgKyB0ZWFtc1sxXVsnbmFtZSddICsgJzo8L3N0cm9uZz4gJyArIHRlYW1zWzFdWydwbGF5ZXJzJ11bMV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1faWQ6IHRlYW1zWzFdWydpZCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2lkOiB0ZWFtc1sxXVsncGxheWVycyddWzFdWydpZCddXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJzxzdHJvbmc+JyArIHRlYW1zWzBdWyduYW1lJ10gKyAnOjwvc3Ryb25nPiAnICsgdGVhbXNbMF1bJ3BsYXllcnMnXVswXVsnbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogdGVhbXNbMF1bJ2lkJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfaWQ6IHRlYW1zWzBdWydwbGF5ZXJzJ11bMF1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgcm93cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAnPHN0cm9uZz4nICsgdGVhbXNbMV1bJ25hbWUnXSArICc6PC9zdHJvbmc+ICcgKyB0ZWFtc1sxXVsncGxheWVycyddWzFdWyduYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtX2lkOiB0ZWFtc1sxXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMV1bJ3BsYXllcnMnXVsxXVsnaWQnXVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICByb3dzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICc8c3Ryb25nPicgKyB0ZWFtc1swXVsnbmFtZSddICsgJzo8L3N0cm9uZz4gJyArIHRlYW1zWzBdWydwbGF5ZXJzJ11bMV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlYW1faWQ6IHRlYW1zWzBdWydpZCddLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyX2lkOiB0ZWFtc1swXVsncGxheWVycyddWzFdWydpZCddXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogJzxzdHJvbmc+JyArIHRlYW1zWzFdWyduYW1lJ10gKyAnOjwvc3Ryb25nPiAnICsgdGVhbXNbMV1bJ3BsYXllcnMnXVswXVsnbmFtZSddLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogdGVhbXNbMV1bJ2lkJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJfaWQ6IHRlYW1zWzFdWydwbGF5ZXJzJ11bMF1bJ2lkJ11cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzBdWyduYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtX2lkOiB0ZWFtc1swXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzFdWyduYW1lJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtX2lkOiB0ZWFtc1sxXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzBdWydwbGF5ZXJzJ11bMF1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMF1bJ3BsYXllcnMnXVswXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzBdWydwbGF5ZXJzJ11bMV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMF1bJ3BsYXllcnMnXVsxXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzFdWydwbGF5ZXJzJ11bMF1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMV1bJ3BsYXllcnMnXVswXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZm9vdGVyLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6IHRlYW1zWzFdWydwbGF5ZXJzJ11bMV1bJ25hbWUnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZDogdGVhbXNbMV1bJ3BsYXllcnMnXVsxXVsnaWQnXSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgcm93czogcm93cyxcbiAgICAgICAgICAgICAgICBmb290ZXI6IGZvb3RlclxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUG9wdWxhdGVzIHRoZSBzY29yZXMgbW9kYWwgdGFibGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gY29sdW1uc1xuICAgICAgICAgKiBAcGFyYW0gcm93c1xuICAgICAgICAgKiBAcGFyYW0gZm9vdGVyXG4gICAgICAgICAqL1xuICAgICAgICBzY29yZXNfbW9kYWxfcG9wdWxhdGVfdGFibGU6IGZ1bmN0aW9uIChjb2x1bW5zLCByb3dzLCBmb290ZXIpIHtcblxuICAgICAgICAgICAgdmFyICR0YWJsZSA9IGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJy5waW5ncG9uZy1zY29yZXMtdGFibGUnKSxcbiAgICAgICAgICAgICAgICAkdGJvZHkgPSAkdGFibGUuZmluZCgndGJvZHknKSxcbiAgICAgICAgICAgICAgICAkdGZvb3QgPSAkdGFibGUuZmluZCgndGZvb3QnKSxcbiAgICAgICAgICAgICAgICAkdGhlYWRfcm93LFxuICAgICAgICAgICAgICAgICR0Ym9keV9yb3dzLFxuICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICBwbGF5ZXJfaWQsIHRlYW1faWQsXG4gICAgICAgICAgICAgICAgcm93X2ksIGNvbHVtbl9pLCBmb290X2k7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGVhZFxuICAgICAgICAgICAgJHRhYmxlLmZpbmQoJ3RoZWFkJykuYXBwZW5kKCc8dHIgLz4nKTtcbiAgICAgICAgICAgICR0aGVhZF9yb3cgPSAkdGFibGUuZmluZCgndGhlYWQgdHInKTtcbiAgICAgICAgICAgICR0aGVhZF9yb3cuYXBwZW5kKCc8dGggLz4nKTtcblxuICAgICAgICAgICAgZm9yIChjb2x1bW5faSA9IDA7IGNvbHVtbl9pIDwgY29sdW1uczsgY29sdW1uX2krKykge1xuXG4gICAgICAgICAgICAgICAgJHRoZWFkX3Jvdy5hcHBlbmQoJCgnPHRoPicgKyBsMTBuWydnYW1lJ10gKyAnICcgKyAoY29sdW1uX2kgKyAxKSArICc8L3RoPicpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRib2R5XG4gICAgICAgICAgICBmb3IgKHJvd19pID0gMDsgcm93X2kgPCByb3dzLmxlbmd0aDsgcm93X2krKykge1xuXG4gICAgICAgICAgICAgICAgcGxheWVyX2lkID0gdHlwZW9mIHJvd3Nbcm93X2ldWydwbGF5ZXJfaWQnXSAhPSAndW5kZWZpbmVkJyA/IHJvd3Nbcm93X2ldWydwbGF5ZXJfaWQnXSA6ICcnO1xuICAgICAgICAgICAgICAgIHRlYW1faWQgPSB0eXBlb2Ygcm93c1tyb3dfaV1bJ3RlYW1faWQnXSAhPSAndW5kZWZpbmVkJyA/IHJvd3Nbcm93X2ldWyd0ZWFtX2lkJ10gOiAnJztcblxuICAgICAgICAgICAgICAgIHJvdyA9ICc8dHIgZGF0YS1wbGF5ZXItaWQ9XCInICsgcGxheWVyX2lkICsgJ1wiIGRhdGEtdGVhbS1pZD1cIicgKyB0ZWFtX2lkICtcbiAgICAgICAgICAgICAgICAgICAgJ1wiPjx0ZD4nICsgcm93c1tyb3dfaV1bJ2xhYmVsJ10gKyAnPC90ZD4nXG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbHVtbl9pID0gMDsgY29sdW1uX2kgPCBjb2x1bW5zOyBjb2x1bW5faSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcm93ID0gcm93ICsgJzx0ZD48aW5wdXQgdHlwZT1cIm51bWJlclwiIHZhbHVlPVwiMFwiIC8+PC90ZD4nO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJvdyA9IHJvdyArICc8L3RyPidcblxuICAgICAgICAgICAgICAgICR0Ym9keS5hcHBlbmQoJChyb3cpKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ3JlYXRlIHRmb290XG4gICAgICAgICAgICBpZiAoZm9vdGVyKSB7XG5cbiAgICAgICAgICAgICAgICAkdGZvb3QuYXBwZW5kKCQoXG4gICAgICAgICAgICAgICAgICAgICc8dHIgY2xhc3M9XCJwaW5ncG9uZy10Zm9vdC10aXRsZVwiPjx0ZCBjb2xzcGFuPVwiJyArIChjb2x1bW5zICsgMSkgKyAnXCI+JyArIGwxMG5bJ3RvdGFscyddICsgJzo8L3RkPjwvdHI+J1xuICAgICAgICAgICAgICAgICkpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChmb290X2kgPSAwOyBmb290X2kgPCBmb290ZXIubGVuZ3RoOyBmb290X2krKykge1xuXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcl9pZCA9IHR5cGVvZiBmb290ZXJbZm9vdF9pXVsncGxheWVyX2lkJ10gIT0gJ3VuZGVmaW5lZCcgPyBmb290ZXJbZm9vdF9pXVsncGxheWVyX2lkJ10gOiAnJztcbiAgICAgICAgICAgICAgICAgICAgdGVhbV9pZCA9IHR5cGVvZiBmb290ZXJbZm9vdF9pXVsndGVhbV9pZCddICE9ICd1bmRlZmluZWQnID8gZm9vdGVyW2Zvb3RfaV1bJ3RlYW1faWQnXSA6ICcnO1xuXG4gICAgICAgICAgICAgICAgICAgICR0Zm9vdC5hcHBlbmQoJChcbiAgICAgICAgICAgICAgICAgICAgICAgICc8dHI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHRkPicgKyBmb290ZXJbZm9vdF9pXVsnbGFiZWwnXSArICc8L3RkPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzx0ZCBkYXRhLXBsYXllci1pZD1cIicgKyBwbGF5ZXJfaWQgKyAnXCIgZGF0YS10ZWFtLWlkPVwiJyArIHRlYW1faWQgKyAnXCI+MDwvdGQ+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPHRkIGNvbHNwYW49XCInICsgKGNvbHVtbnMgLSAxKSArICdcIj48L3RkPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJzwvdHI+J1xuICAgICAgICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHNjb3Jlc1xuICAgICAgICAgICAgaWYgKGRhdGEuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICBhcGkuc2NvcmVzX21vZGFsX3BvcHVsYXRlX3Njb3JlcyhkYXRhLnNjb3Jlcy5tYXRjaGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogUG9wdWxhdGVzIHRoZSB0YWJsZSB3aXRoIHByZXZpb3VzbHkgc2V0IHNjb3Jlcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSBtYXRjaGVzXG4gICAgICAgICAqL1xuICAgICAgICBzY29yZXNfbW9kYWxfcG9wdWxhdGVfc2NvcmVzOiBmdW5jdGlvbiAobWF0Y2hlcykge1xuXG4gICAgICAgICAgICB2YXIgaTtcblxuICAgICAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoICE9PSBhcGkuJHNjb3Jlc19tb2RhbC5maW5kKCd0Ym9keSB0cicpLmxlbmd0aCAvIDIpIHtcblxuICAgICAgICAgICAgICAgIGFwaS5zY29yZXNfbW9kYWxfZXJyb3IobDEwblsnY2FudF9sb2FkX3Njb3JlcyddKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJ3Rib2R5IHRkOm5vdCg6Zmlyc3Qtb2YtdHlwZSkgaW5wdXRbdHlwZT1cIm51bWJlclwiXScpLmVhY2goZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgdmFyICRyb3cgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJyksXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoID0gTWF0aC5mbG9vcigkcm93LmluZGV4KCkgLyAyKSxcbiAgICAgICAgICAgICAgICAgICAgZ2FtZSA9ICQodGhpcykuY2xvc2VzdCgndGQnKS5pbmRleCgpIC0gMSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyX2luZGV4ID0gJHJvdy5pbmRleCgpICUgMiA9PT0gMSA/IDEgOiAwO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzKS52YWwobWF0Y2hlc1ttYXRjaF1bZ2FtZV1bcGxheWVyX2luZGV4XSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXBpLnNjb3Jlc191cGRhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2hvd3MgYW4gZXJyb3IuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gbWVzc2FnZVxuICAgICAgICAgKi9cbiAgICAgICAgc2NvcmVzX21vZGFsX2Vycm9yOiBmdW5jdGlvbiAobWVzc2FnZSkge1xuXG4gICAgICAgICAgICBhcGkuJHNjb3Jlc19tb2RhbC5maW5kKCcucGluZ3Bvbmctc2NvcmVzLWVycm9yJykuc2xpZGVEb3duKCkuZmluZCgncCcpLmh0bWwobWVzc2FnZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENsb3NlcyB0aGUgc2NvcmVzIG1vZGFsLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIHNjb3Jlc19tb2RhbF9jbG9zZTogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAkKCdib2R5JykucmVtb3ZlQ2xhc3MoJ3Bpbmdwb25nLW1vZGFsLW9wZW4nKTtcblxuICAgICAgICAgICAgYXBpLiRzY29yZXNfbW9kYWwuZmluZCgnLnBpbmdwb25nLXNjb3Jlcy1lcnJvcicpLmhpZGUoKTtcbiAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJ3RoZWFkLCB0Ym9keSwgdGZvb3QnKS5odG1sKCcnKTtcbiAgICAgICAgICAgIGFwaS4kc2NvcmVzX21vZGFsLmhpZGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogVXBkYXRlcyBhbGwgb2YgdGhlIHNjb3JlcyBpbiB0aGUgdGFibGUuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgc2NvcmVzX3VwZGF0ZTogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgdG90YWxfbWF0Y2hlcyA9IGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJ3Rib2R5IHRyJykubGVuZ3RoIC8gMixcbiAgICAgICAgICAgICAgICB0b3RhbF9nYW1lcyA9IGFwaS4kc2NvcmVzX21vZGFsLmZpbmQoJ3RoZWFkIHRoJykubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgICAgICBtYXRjaF9pLCBnYW1lX2ksXG4gICAgICAgICAgICAgICAgcGxheWVycyA9IHt9LFxuICAgICAgICAgICAgICAgIHRlYW1zID0ge30sXG4gICAgICAgICAgICAgICAgbWF0Y2ggPSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbjogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgc2NvcmVzOiBbXSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyXzE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVzOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvdzogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyXzI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbV9pZDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVzOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvdzogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGdhbWUgPSB7XG4gICAgICAgICAgICAgICAgICAgIHBsYXllcl8xOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICRpbnB1dDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyXzI6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3JlOiAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgJGlucHV0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbWF0Y2hlcyA9IFtdO1xuXG4gICAgICAgICAgICBmb3IgKG1hdGNoX2kgPSAwOyBtYXRjaF9pIDwgdG90YWxfbWF0Y2hlczsgbWF0Y2hfaSsrKSB7XG5cbiAgICAgICAgICAgICAgICBtYXRjaC5wbGF5ZXJfMS4kcm93ID0gYXBpLiRzY29yZXNfbW9kYWwuZmluZCgndGJvZHkgdHI6ZXEoJyArIChtYXRjaF9pICogMikgKyAnKScpO1xuICAgICAgICAgICAgICAgIG1hdGNoLnBsYXllcl8yLiRyb3cgPSBhcGkuJHNjb3Jlc19tb2RhbC5maW5kKCd0Ym9keSB0cjplcSgnICsgKChtYXRjaF9pICogMikgKyAxKSArICcpJyk7XG5cbiAgICAgICAgICAgICAgICBtYXRjaC5wbGF5ZXJfMS5pZCA9IG1hdGNoLnBsYXllcl8xLiRyb3cuYXR0cignZGF0YS1wbGF5ZXItaWQnKTtcbiAgICAgICAgICAgICAgICBtYXRjaC5wbGF5ZXJfMi5pZCA9IG1hdGNoLnBsYXllcl8yLiRyb3cuYXR0cignZGF0YS1wbGF5ZXItaWQnKTtcblxuICAgICAgICAgICAgICAgIG1hdGNoLnBsYXllcl8xLnRlYW1faWQgPSBtYXRjaC5wbGF5ZXJfMS4kcm93LmF0dHIoJ2RhdGEtdGVhbS1pZCcpO1xuICAgICAgICAgICAgICAgIG1hdGNoLnBsYXllcl8yLnRlYW1faWQgPSBtYXRjaC5wbGF5ZXJfMi4kcm93LmF0dHIoJ2RhdGEtdGVhbS1pZCcpO1xuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwbGF5ZXJzW21hdGNoLnBsYXllcl8xLmlkXSA9PSAndW5kZWZpbmVkJykge1xuXG4gICAgICAgICAgICAgICAgICAgIHBsYXllcnMubGVuZ3RoKys7XG4gICAgICAgICAgICAgICAgICAgIHBsYXllcnNbbWF0Y2gucGxheWVyXzEuaWRdID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZXM6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb2ludHM6IDBcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBsYXllcnNbbWF0Y2gucGxheWVyXzIuaWRdID09ICd1bmRlZmluZWQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcGxheWVycy5sZW5ndGgrKztcbiAgICAgICAgICAgICAgICAgICAgcGxheWVyc1ttYXRjaC5wbGF5ZXJfMi5pZF0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lczogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvaW50czogMFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGVhbXNbbWF0Y2gucGxheWVyXzEudGVhbV9pZF0gPT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgICAgICAgICAgICAgICAgICB0ZWFtcy5sZW5ndGgrKztcbiAgICAgICAgICAgICAgICAgICAgdGVhbXNbbWF0Y2gucGxheWVyXzEudGVhbV9pZF0gPSAwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdGVhbXNbbWF0Y2gucGxheWVyXzIudGVhbV9pZF0gPT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgICAgICAgICAgICAgICAgICB0ZWFtcy5sZW5ndGgrKztcbiAgICAgICAgICAgICAgICAgICAgdGVhbXNbbWF0Y2gucGxheWVyXzIudGVhbV9pZF0gPSAwO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG1hdGNoLnBsYXllcl8xLmdhbWVzID0gMDtcbiAgICAgICAgICAgICAgICBtYXRjaC5wbGF5ZXJfMi5nYW1lcyA9IDA7XG4gICAgICAgICAgICAgICAgbWF0Y2gud2luID0gbnVsbDtcbiAgICAgICAgICAgICAgICBtYXRjaC5zY29yZXMgPSBbXTtcblxuICAgICAgICAgICAgICAgIGZvciAoZ2FtZV9pID0gMDsgZ2FtZV9pIDwgdG90YWxfZ2FtZXM7IGdhbWVfaSsrKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJfMS4kaW5wdXQgPSBtYXRjaC5wbGF5ZXJfMS4kcm93LmZpbmQoJ3RkOmVxKCcgKyAoZ2FtZV9pICsgMSkgKyAnKSBpbnB1dFt0eXBlPVwibnVtYmVyXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyXzIuJGlucHV0ID0gbWF0Y2gucGxheWVyXzIuJHJvdy5maW5kKCd0ZDplcSgnICsgKGdhbWVfaSArIDEpICsgJykgaW5wdXRbdHlwZT1cIm51bWJlclwiXScpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIFBsYXllciB3aW5zIG1hdGNoIGJ5IHdpbm5pbmcgYSBjZXJ0YWluIG51bWJlciBvZiBnYW1lc1xuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2gucGxheWVyXzEuZ2FtZXMgPj0gTWF0aC5mbG9vcih0b3RhbF9nYW1lcyAvIDIpICsgMSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaC53aW4gPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJfMS4kaW5wdXQucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyXzIuJGlucHV0LnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5wbGF5ZXJfMi5nYW1lcyA+PSBNYXRoLmZsb29yKHRvdGFsX2dhbWVzIC8gMikgKyAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoLndpbiA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllcl8xLiRpbnB1dC5wcm9wKCdkaXNhYmxlZCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJfMi4kaW5wdXQucHJvcCgnZGlzYWJsZWQnLCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBnYW1lLnBsYXllcl8xLiRpbnB1dC5wcm9wKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhbWUucGxheWVyXzIuJGlucHV0LnByb3AoJ2Rpc2FibGVkJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJfMS5zY29yZSA9IHBhcnNlSW50KGdhbWUucGxheWVyXzEuJGlucHV0LnZhbCgpKTtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5wbGF5ZXJfMi5zY29yZSA9IHBhcnNlSW50KGdhbWUucGxheWVyXzIuJGlucHV0LnZhbCgpKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBBd2FyZCBhIHBsYXllciBhIGdhbWVcbiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUucGxheWVyXzEuc2NvcmUgPj0gMTEgJiYgKGdhbWUucGxheWVyXzEuc2NvcmUgLSBnYW1lLnBsYXllcl8yLnNjb3JlID49IDIpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoLnBsYXllcl8xLmdhbWVzKys7XG5cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChnYW1lLnBsYXllcl8yLnNjb3JlID49IDExICYmIChnYW1lLnBsYXllcl8yLnNjb3JlIC0gZ2FtZS5wbGF5ZXJfMS5zY29yZSA+PSAyKSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaC5wbGF5ZXJfMi5nYW1lcysrO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbWF0Y2guc2NvcmVzLnB1c2goW1xuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBtYXRjaC5wbGF5ZXJfMS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29yZTogZ2FtZS5wbGF5ZXJfMS5zY29yZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogbWF0Y2gucGxheWVyXzIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmU6IGdhbWUucGxheWVyXzIuc2NvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy9wbGF5ZXJzW21hdGNoLnBsYXllcl8xLmlkXS5wb2ludHMgPSBwbGF5ZXJzW21hdGNoLnBsYXllcl8xLmlkXS5wb2ludHMgKyBnYW1lLnBsYXllcl8xLnNjb3JlO1xuICAgICAgICAgICAgICAgICAgICAvL3BsYXllcnNbbWF0Y2gucGxheWVyXzIuaWRdLnBvaW50cyA9IHBsYXllcnNbbWF0Y2gucGxheWVyXzIuaWRdLnBvaW50cyArIGdhbWUucGxheWVyXzIuc2NvcmU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcGxheWVyc1ttYXRjaC5wbGF5ZXJfMS5pZF0uZ2FtZXMgPSBwbGF5ZXJzW21hdGNoLnBsYXllcl8xLmlkXS5nYW1lcyArIG1hdGNoLnBsYXllcl8xLmdhbWVzO1xuICAgICAgICAgICAgICAgIHBsYXllcnNbbWF0Y2gucGxheWVyXzIuaWRdLmdhbWVzID0gcGxheWVyc1ttYXRjaC5wbGF5ZXJfMi5pZF0uZ2FtZXMgKyBtYXRjaC5wbGF5ZXJfMi5nYW1lcztcblxuICAgICAgICAgICAgICAgIGlmIChtYXRjaC53aW4pIHtcblxuICAgICAgICAgICAgICAgICAgICB0ZWFtc1ttYXRjaFsncGxheWVyXycgKyBtYXRjaC53aW5dLnRlYW1faWRdID0gdGVhbXNbbWF0Y2hbJ3BsYXllcl8nICsgbWF0Y2gud2luXS50ZWFtX2lkXSArIDE7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKG1hdGNoLnNjb3Jlcyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB0b3RhbHNcbiAgICAgICAgICAgIGFwaS5zY29yZXMucGxheWVycyA9IHBsYXllcnM7XG4gICAgICAgICAgICBhcGkuc2NvcmVzLnRlYW1zID0gdGVhbXM7XG4gICAgICAgICAgICBhcGkuc2NvcmVzLm1hdGNoZXMgPSBtYXRjaGVzO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcGkuc2NvcmVzKTtcblxuICAgICAgICAgICAgJC5lYWNoKHBsYXllcnMsIGZ1bmN0aW9uIChwbGF5ZXJfSUQsIHBsYXllcikge1xuXG4gICAgICAgICAgICAgICAgaWYgKHBsYXllcl9JRCA9PSAnbGVuZ3RoJyB8fCAhcGxheWVyX0lEKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgYXBpLiRzY29yZXNfbW9kYWwuZmluZCgndGZvb3QgW2RhdGEtcGxheWVyLWlkPVwiJyArIHBsYXllcl9JRCArICdcIl0nKS5odG1sKHBsYXllci5nYW1lcyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJC5lYWNoKHRlYW1zLCBmdW5jdGlvbiAodGVhbV9JRCwgdGVhbV9zY29yZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRlYW1fSUQgPT0gJ2xlbmd0aCcgfHwgIXRlYW1fSUQpIHtcblxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBhcGkuJHNjb3Jlc19tb2RhbC5maW5kKCd0Zm9vdCBbZGF0YS10ZWFtLWlkPVwiJyArIHRlYW1fSUQgKyAnXCJdJykuaHRtbCh0ZWFtX3Njb3JlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTYXZlcyB0aGUgc2NvcmVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIHNjb3Jlc19tb2RhbF9zdWJtaXQ6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgaWYgKCFjb25maXJtKGwxMG5bJ2NvbmZpcm1fc3VibWl0X21hdGNoJ10pKSB7XG5cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICQucG9zdChcbiAgICAgICAgICAgICAgICBhamF4dXJsLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiAncGluZ3Bvbmdfc3VibWl0X3Njb3JlcycsXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoX0lEOiBkYXRhLm1hdGNoX0lELFxuICAgICAgICAgICAgICAgICAgICBzY29yZXM6IGFwaS5zY29yZXNcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2Uuc3VjY2VzcyA9PSAndW5kZWZpbmVkJyB8fCAhcmVzcG9uc2Uuc3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBhbGVydChsMTBuWydjb3VsZF9ub3Rfc2F2ZV9tYXRjaCddKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vd2luZG93LmxvY2F0aW9uID0gcmVzcG9uc2UuZGF0YS5yZWRpcmVjdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8vKipcbiAgICAgICAgLy8gKiBGaXJlcyB3aGVuIHNlbGVjdGluZyBhIHBsYXllci5cbiAgICAgICAgLy8gKlxuICAgICAgICAvLyAqIFByZXZlbnRzIGR1cGxpY2F0ZSBwbGF5ZXIgc2VsZWN0cyB3aXRoaW4gcGxheWVyIGdyb3Vwcy5cbiAgICAgICAgLy8gKlxuICAgICAgICAvLyAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAvLyAqL1xuICAgICAgICAvL3BsYXllcl9zZWxlY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgdmFyIHBsYXllciA9ICQodGhpcykudmFsKCksXG4gICAgICAgIC8vICAgICAgICAkcGxheWVyX3NlbGVjdF9hY3RpdmUgPSAkKHRoaXMpLmNsb3Nlc3QoJy5wbGF5ZXItc2VsZWN0JyksXG4gICAgICAgIC8vICAgICAgICBwcmV2aW91c19wbGF5ZXIgPSAkcGxheWVyX3NlbGVjdF9hY3RpdmUuYXR0cignZGF0YS1hY3RpdmUnKSxcbiAgICAgICAgLy8gICAgICAgICRwbGF5ZXJfc2VsZWN0X2dyb3VwID0gJCh0aGlzKS5jbG9zZXN0KCcucGxheWVyLXNlbGVjdC1ncm91cCcpLFxuICAgICAgICAvLyAgICAgICAgJHBsYXllcl9zZWxlY3RzID0gJHBsYXllcl9zZWxlY3RfZ3JvdXAuZmluZCgnLnBsYXllci1zZWxlY3QnKS5ub3QoJHBsYXllcl9zZWxlY3RfYWN0aXZlKTtcbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgaWYgKHByZXZpb3VzX3BsYXllcikge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgJHBsYXllcl9zZWxlY3RzLmZpbmQoJ29wdGlvblt2YWx1ZT1cIicgKyBwcmV2aW91c19wbGF5ZXIgKyAnXCJdJykucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgIC8vICAgIH1cbiAgICAgICAgLy9cbiAgICAgICAgLy8gICAgaWYgKHBsYXllcikge1xuICAgICAgICAvL1xuICAgICAgICAvLyAgICAgICAgJHBsYXllcl9zZWxlY3RfYWN0aXZlLmF0dHIoJ2RhdGEtYWN0aXZlJywgcGxheWVyKTtcbiAgICAgICAgLy8gICAgICAgICRwbGF5ZXJfc2VsZWN0cy5maW5kKCdvcHRpb25bdmFsdWU9XCInICsgcGxheWVyICsgJ1wiXScpLnByb3AoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgIH0gZWxzZSB7XG4gICAgICAgIC8vXG4gICAgICAgIC8vICAgICAgICAkcGxheWVyX3NlbGVjdF9hY3RpdmUucmVtb3ZlQXR0cignZGF0YS1hY3RpdmUnKTtcbiAgICAgICAgLy8gICAgfVxuICAgICAgICAvL31cbiAgICB9XG5cbiAgICAkKGFwaS5pbml0KTtcbn0pKGpRdWVyeSlcbnZhciBQaW5nUG9uZ19BZG1pbl9NYXRjaENQVHNcbihmdW5jdGlvbiAoJCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBkYXRhID0ge30sIGwxMG4gPSB7fTtcblxuICAgIGlmICh0eXBlb2YgUGluZ1BvbmdfQWRtaW4gIT0gJ3VuZGVmaW5lZCcpIHtcblxuICAgICAgICBkYXRhID0gUGluZ1BvbmdfQWRtaW47XG4gICAgICAgIGwxMG4gPSB0eXBlb2YgUGluZ1BvbmdfQWRtaW4ubDEwbiAhPSAndW5kZWZpbmVkJyA/IFBpbmdQb25nX0FkbWluLmwxMG4gOiB7fTtcbiAgICB9XG5cbiAgICB2YXIgYXBpID0gUGluZ1BvbmdfQWRtaW5fTWF0Y2hDUFRzID0ge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBHYW1lcyB0YWJsZS5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICAkZ2FtZXM6IG51bGwsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWxpemVzIHRoZSBvYmplY3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICBhcGkuZ2V0X2VsZW1lbnRzKCk7XG4gICAgICAgICAgICBhcGkuc2V0dXBfaGFuZGxlcnMoKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogR2V0cyBhbGwgalF1ZXJ5IGVsZW1lbnRzIG5lZWRlZC5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBnZXRfZWxlbWVudHM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgYXBpLiRnYW1lcyA9ICQoJyNwaW5ncG9uZy13b24tZ2FtZXMnKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0cyB1cCBoYW5kbGVycyBvbiBldmVudHMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKi9cbiAgICAgICAgc2V0dXBfaGFuZGxlcnM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ1tkYXRhLWV4cGFuZC1nYW1lc10nLCBhcGkudG9nZ2xlX2dhbWVzKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogSGlkZXMgb3Igc2hvd3MgZ2FtZXMuXG4gICAgICAgICAqXG4gICAgICAgICAqIEBzaW5jZSB7e1ZFUlNJT059fVxuICAgICAgICAgKlxuICAgICAgICAgKiBAcGFyYW0gZVxuICAgICAgICAgKi9cbiAgICAgICAgdG9nZ2xlX2dhbWVzOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgICAgICB2YXIgaGlkZSA9IGFwaS4kZ2FtZXMuaXMoJzp2aXNpYmxlJyk7XG5cbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcblxuICAgICAgICAgICAgaWYgKGhpZGUpIHtcblxuICAgICAgICAgICAgICAgICQodGhpcykuaHRtbChsMTBuWyd2aWV3X21hdGNoZXMnXSk7XG4gICAgICAgICAgICAgICAgYXBpLmhpZGVfZ2FtZXMoKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICQodGhpcykuaHRtbChsMTBuWydoaWRlX21hdGNoZXMnXSk7XG4gICAgICAgICAgICAgICAgYXBpLmV4cGFuZF9nYW1lcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTaG93cyBnYW1lcy5cbiAgICAgICAgICpcbiAgICAgICAgICogQHNpbmNlIHt7VkVSU0lPTn19XG4gICAgICAgICAqL1xuICAgICAgICBleHBhbmRfZ2FtZXM6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgIGFwaS4kZ2FtZXMuc2hvdygpO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEhpZGVzIGdhbWVzLlxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2luY2Uge3tWRVJTSU9OfX1cbiAgICAgICAgICovXG4gICAgICAgIGhpZGVfZ2FtZXM6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgICAgIGFwaS4kZ2FtZXMuaGlkZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJChhcGkuaW5pdCk7XG59KShqUXVlcnkpIl19
